<!-- Fil d’Ariane -->
<div class="mb-4 flex items-center justify-between gap-3 text-[11px]">
  <div class="inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 font-semibold text-slate-700 ring-1 ring-slate-200">
    <span class="h-1.5 w-1.5 rounded-full bg-violet-600"></span>
    Paramètres
    <span class="text-slate-400">/</span>
    <span class="text-slate-900">Profil entreprise</span>
  </div>

  <span class="hidden sm:inline-flex items-center gap-2 rounded-full bg-slate-900 px-3 py-1 text-[11px] font-semibold text-white ring-1 ring-white/10">
    <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
    Informations utilisées sur tes factures
  </span>
</div>

<!-- Messages d’erreur -->
<% if @company.errors.any? %>
  <div class="mb-6 rounded-3xl border border-rose-200 bg-rose-50 p-5 shadow-sm">
    <div class="flex items-start justify-between gap-3">
      <div>
        <p class="text-sm font-semibold text-rose-800">
          Impossible d’enregistrer les paramètres
        </p>
        <p class="mt-1 text-xs text-rose-700/80">
          Corrige les champs ci-dessous puis réessaie.
        </p>
      </div>
      <span class="inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-rose-100 text-rose-700 ring-1 ring-rose-200">⚠️</span>
    </div>

    <ul class="mt-3 list-disc pl-5 space-y-1 text-xs text-rose-800">
      <% @company.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<!-- HEADER -->
<section class="rounded-[32px] bg-white ring-1 ring-slate-200 shadow-[0_18px_70px_rgba(15,23,42,0.10)] overflow-hidden">
  <div class="p-6 md:p-8">
    <div class="flex flex-col gap-6 md:flex-row md:items-start md:justify-between">
      <div class="min-w-0">
        <div class="flex flex-wrap items-center gap-3">
          <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-slate-700 ring-1 ring-slate-200">
            <span class="h-1.5 w-1.5 rounded-full bg-violet-600"></span>
            Paramètres entreprise
          </span>
          <span class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-[11px] font-semibold text-slate-700 ring-1 ring-slate-200">
            <span class="h-1.5 w-1.5 rounded-full bg-slate-400"></span>
            Factures · Emails · PDF
          </span>
        </div>

        <h1 class="mt-5 text-2xl md:text-3xl font-semibold tracking-tight text-slate-900">
          Profil de l’entreprise
        </h1>
        <p class="mt-1 text-sm text-slate-600 max-w-2xl">
          Ces informations apparaîtront sur tes factures, devis et emails. Mets-les à jour pour garder une présentation pro.
        </p>
      </div>

      <!-- Mini aperçu -->
      <div class="w-full max-w-xl">
        <div class="rounded-3xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden">
          <div class="h-1 w-full bg-gradient-to-r from-indigo-500 via-violet-600 to-fuchsia-500"></div>
          <div class="p-5">
            <p class="text-[10px] font-semibold uppercase tracking-wide text-slate-500">Aperçu</p>
            <div class="mt-3 flex items-center gap-3">
              <% if @company.logo&.attached? %>
                <div class="h-12 w-12 overflow-hidden rounded-2xl bg-slate-100 ring-1 ring-slate-200">
                  <%= image_tag @company.logo.variant(resize_to_limit: [160, 160]), class: "h-full w-full object-contain" %>
                </div>
              <% else %>
                <div class="flex h-12 w-12 items-center justify-center rounded-2xl text-white text-sm font-semibold shadow-sm ring-1 ring-slate-200
                            bg-gradient-to-br from-indigo-500 via-violet-600 to-fuchsia-500">
                  <%= @company.name.to_s.first(2).upcase %>
                </div>
              <% end %>

              <div class="min-w-0">
                <p class="truncate text-sm font-semibold text-slate-900"><%= @company.name.presence || "Nom entreprise" %></p>
                <p class="truncate text-xs text-slate-500">
                  <%= [@company.city, @company.country].compact.join(" · ").presence || "Coordonnées" %>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="my-8 h-px w-full bg-gradient-to-r from-transparent via-slate-200 to-transparent"></div>

    <!-- FORMULAIRE -->
    <%= form_with model: @company, url: settings_path, class: "space-y-8" do |f| %>

      <% input =
          "mt-1 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 shadow-sm " \
          "placeholder-slate-400 focus:border-violet-500 focus:bg-white focus:outline-none focus:ring-1 focus:ring-violet-500"
      %>

      <!-- IDENTITÉ -->
      <section class="rounded-3xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden">
        <div class="flex items-center justify-between border-b border-slate-100 bg-slate-50 px-6 py-3">
          <h2 class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-slate-600">
            <span class="h-1.5 w-1.5 rounded-full bg-violet-600"></span>
            Identité
          </h2>
          <span class="rounded-full bg-slate-900 px-3 py-1 text-[11px] font-semibold text-white ring-1 ring-white/10">
            Affiché sur les documents
          </span>
        </div>

        <div class="p-6 grid gap-6 md:grid-cols-2">
          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Nom commercial</label>
            <%= f.text_field :name, class: input, placeholder: "Kreatix Studio" %>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Raison sociale (optionnel)</label>
            <%= f.text_field :legal_name, class: input, placeholder: "Kreatix Studio SASU" %>
          </div>
        </div>
      </section>

      <!-- LOGO -->
      <section class="rounded-3xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden">
        <div class="flex items-center justify-between border-b border-slate-100 bg-slate-50 px-6 py-3">
          <h2 class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-slate-600">
            <span class="h-1.5 w-1.5 rounded-full bg-violet-600"></span>
            Logo
          </h2>
          <span class="rounded-full bg-gradient-to-r from-indigo-50 via-violet-50 to-fuchsia-50 px-3 py-1 text-[11px] font-semibold text-violet-700 ring-1 ring-slate-200">
            Recommandé : PNG/JPG 400×400
          </span>
        </div>

        <div class="p-6 flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
          <div class="flex items-center gap-4">
            <% if @company.logo&.attached? %>
              <div class="h-20 w-20 flex items-center justify-center rounded-2xl bg-slate-100 overflow-hidden ring-1 ring-slate-200">
                <%= image_tag @company.logo.variant(resize_to_limit: [160, 160]), class: "object-contain h-full w-full" %>
              </div>
            <% else %>
              <div class="flex h-20 w-20 items-center justify-center rounded-2xl text-white text-xl font-semibold shadow-sm ring-1 ring-slate-200
                          bg-gradient-to-br from-indigo-500 via-violet-600 to-fuchsia-500">
                <%= @company.name.to_s.first(2).upcase %>
              </div>
            <% end %>

            <div class="min-w-0">
              <p class="text-sm font-semibold text-slate-900">Aperçu du logo</p>
              <p class="mt-1 text-xs text-slate-600 max-w-sm">
                Le logo s’affiche sur tes factures et emails. Utilise un fond transparent si possible.
              </p>
            </div>
          </div>

          <div class="w-full md:w-[380px] space-y-3">
            <div>
              <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Choisir un fichier</label>

              <!-- ✅ MODIF: bouton "Choisir un fichier" encadré + petit (pas full width) -->
              <div class="mt-2 rounded-2xl border border-slate-200 bg-white px-4 py-3 shadow-sm ring-1 ring-slate-200/60">
                <%= f.file_field :logo,
                      accept: "image/png,image/jpeg,image/svg+xml",
                      class: "block w-full text-xs text-slate-700
                              file:mr-3 file:w-auto
                              file:rounded-xl file:border-2 file:border-slate-900
                              file:bg-white file:px-3 file:py-1.5
                              file:text-[11px] file:font-extrabold file:uppercase file:tracking-wide
                              file:text-slate-900 hover:file:bg-slate-50
                              focus:outline-none" %>

                <p class="mt-2 text-[11px] text-slate-500">
                  PNG/JPG/SVG — recommandé 400×400, idéalement 1–2 Mo max.
                </p>
              </div>
            </div>

            <% if @company.logo&.attached? %>
              <div class="flex items-center gap-2 text-xs rounded-2xl bg-slate-50 ring-1 ring-slate-200 px-3 py-2">
                <%= f.check_box :remove_logo, class: "rounded border-slate-300 text-violet-600 focus:ring-violet-500" %>
                <%= f.label :remove_logo, "Supprimer le logo", class: "text-slate-700 font-semibold" %>
              </div>
            <% end %>
          </div>
        </div>
      </section>

      <!-- COORDONNÉES -->
      <section class="rounded-3xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden">
        <div class="flex items-center justify-between border-b border-slate-100 bg-slate-50 px-6 py-3">
          <h2 class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-slate-600">
            <span class="h-1.5 w-1.5 rounded-full bg-violet-600"></span>
            Coordonnées
          </h2>
          <span class="rounded-full bg-white px-3 py-1 text-[11px] font-semibold text-slate-700 ring-1 ring-slate-200">
            Optionnel mais recommandé
          </span>
        </div>

        <div class="p-6 grid gap-6 md:grid-cols-2">
          <div class="md:col-span-2">
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Adresse</label>
            <%= f.text_field :address, class: input, placeholder: "12 Rue de la Paix" %>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Code postal</label>
            <%= f.text_field :zip_code, class: input, placeholder: "75010" %>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Ville</label>
            <%= f.text_field :city, class: input, placeholder: "Paris" %>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Pays</label>
            <%= f.text_field :country, class: input, placeholder: "France" %>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Téléphone</label>
            <%= f.text_field :phone, class: input, placeholder: "+33 6 12 34 56 78" %>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Site web</label>
            <%= f.text_field :website, class: input, placeholder: "https://kreatix-studio.fr" %>
          </div>

          <div class="md:col-span-2">
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Email de contact</label>
            <%= f.email_field :email, class: input, placeholder: "contact@kreatix-studio.fr" %>
          </div>
        </div>
      </section>

      <!-- INFORMATIONS LÉGALES -->
      <section class="rounded-3xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden">
        <div class="flex items-center justify-between border-b border-slate-100 bg-slate-50 px-6 py-3">
          <h2 class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-slate-600">
            <span class="h-1.5 w-1.5 rounded-full bg-violet-600"></span>
            Informations légales
          </h2>
          <span class="rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-700 ring-1 ring-slate-200">
            SIREN / TVA
          </span>
        </div>

        <div class="p-6 grid gap-6 md:grid-cols-2">
          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">SIREN</label>
            <%= f.text_field :siren, class: input, placeholder: "000 000 000" %>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">N° TVA</label>
            <%= f.text_field :vat_number, class: input, placeholder: "FR12345678901" %>
          </div>
        </div>
      </section>

      <!-- BANQUE -->
      <section class="rounded-3xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden">
        <div class="flex items-center justify-between border-b border-slate-100 bg-slate-50 px-6 py-3">
          <h2 class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-slate-600">
            <span class="h-1.5 w-1.5 rounded-full bg-violet-600"></span>
            Informations bancaires
          </h2>
          <span class="rounded-full bg-gradient-to-r from-indigo-50 via-violet-50 to-fuchsia-50 px-3 py-1 text-[11px] font-semibold text-violet-700 ring-1 ring-slate-200">
            Affiché sur la facture (optionnel)
          </span>
        </div>

        <div class="p-6 space-y-5">
          <div class="grid gap-6 md:grid-cols-2">
            <div>
              <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">IBAN</label>
              <%= f.text_field :iban, class: input, placeholder: "FR76 ...." %>
            </div>

            <div>
              <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">BIC</label>
              <%= f.text_field :bic, class: input, placeholder: "AGRIFRPP..." %>
            </div>
          </div>

          <div>
            <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">Instructions de paiement</label>
            <%= f.text_area :payment_instructions,
                  rows: 3,
                  class: "mt-1 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900 shadow-sm
                          placeholder-slate-400 focus:border-violet-500 focus:bg-white focus:outline-none focus:ring-1 focus:ring-violet-500",
                  placeholder: "Ex : Paiement par virement sous 30 jours..." %>
          </div>
        </div>
      </section>

      <!-- BOUTONS -->
      <div class="flex justify-end gap-3 pt-2">
        <%= link_to "Annuler",
                    dashboard_path,
                    class: "rounded-2xl bg-slate-100 px-4 py-2 text-sm font-semibold text-slate-800 ring-1 ring-slate-200 hover:bg-slate-200/60 transition" %>

        <%= f.submit "Enregistrer",
                     class: "inline-flex items-center justify-center rounded-2xl px-5 py-2 text-sm font-semibold text-white shadow-sm transition active:scale-[0.99]
                             bg-gradient-to-r from-indigo-500 via-violet-600 to-fuchsia-500 hover:brightness-110 cursor-pointer" %>
      </div>

    <% end %>
  </div>
</section>

<!-- SUPPRESSION DE COMPTE -->
<section class="mt-10 rounded-3xl bg-white ring-1 ring-rose-200 shadow-sm overflow-hidden">
  <div class="border-b border-rose-100 bg-rose-50 px-6 py-3">
    <h2 class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-rose-700">
      <span class="h-1.5 w-1.5 rounded-full bg-rose-600"></span>
      Zone sensible
    </h2>
  </div>

  <div class="p-6">
    <p class="text-sm text-slate-700">
      Supprimer ton compte effacera <strong>définitivement</strong> ton entreprise, tes clients et toutes tes factures.
      Cette action est irréversible.
    </p>

    <div class="mt-5">
      <%= button_to "Supprimer définitivement mon compte",
            registration_path(:user),
            method: :delete,
            data: {
              turbo_confirm: "⚠️ Es-tu sûr de vouloir supprimer ton compte ?\nToutes les données associées seront effacées."
            },
            class: "inline-flex items-center justify-center rounded-2xl bg-rose-600 px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-rose-700 transition cursor-pointer" %>
    </div>
  </div>
</section>
